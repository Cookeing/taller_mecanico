{% extends "base.html" %} {% block content %}
<h2 class="mb-3">{{ accion }} veh√≠culo</h2>

{% if form.non_field_errors %}
<div class="alert alert-danger">{{ form.non_field_errors }}</div>
{% endif %}

<form method="post" class="card p-3 shadow-sm bg-white" novalidate>
  {% csrf_token %} {% for field in form %}
  <div class="mb-3">
    <label class="form-label">
      {{ field.label }} {% if field.field.required %}
      <span class="text-danger">*</span>
      {% endif %}
    </label>

    {% if field.name == 'cliente' %}
    <div class="d-flex gap-2">
      {{ field }}
      <a
        href="{% url 'clientes:create' %}?next={{ request.path }}"
        class="btn btn-outline-success"
        onclick="abrirPopupCliente(event)"
        title="Agregar nuevo cliente"
      >
        +
      </a>
    </div>
    <small class="text-muted">
      Haz clic en <strong>+</strong> para agregar un cliente nuevo
    </small>
    {% else %} {{ field }} {% endif %} {% if field.errors %} {% for error in field.errors %}
    <div class="text-danger small mt-1">{{ error }}</div>
    {% endfor %}{% endif %} {% if field.help_text %}
    <small class="form-text text-muted">{{ field.help_text }}</small>
    {% endif %}
  </div>
  {% endfor %}

  <div class="d-flex gap-2">
    <input type="submit" value="üíæ Guardar" class="btn btn-primary" />
    <a href="{% url 'vehiculos:list' %}" class="btn btn-secondary">
      ‚¨ÖÔ∏è Volver
    </a>
  </div>
</form>

<script>
  function abrirPopupCliente(e) {
    e.preventDefault();
    const width = 600;
    const height = 700;
    const left = (screen.width - width) / 2;
    const top = (screen.height - height) / 2;

    const popup = window.open(
      e.target.closest("a").href,
      "nuevoCliente",
      `width=${width},height=${height},left=${left},top=${top}`
    );

    const checkClosed = setInterval(function () {
      if (popup.closed) {
        clearInterval(checkClosed);
        location.reload();
      }
    }, 500);
  }
</script>

{% endblock %}
